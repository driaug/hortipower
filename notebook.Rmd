---
title: "Hortipower Notebook"
output: html_notebook
---
**Group 3**

* Group members:
    - Dries Augustyns
    - Miguel Haest
    - Niels Baptist

## Introduction
In this notebook, We will report our findings of the kaggle dataset of **Hortipower**, the data consists out of sensor data from a tomato growing greenhouse. We will visualise and report some of the most interesting data insights we discovered, we hope that we can add a valuable contribution. 

## Packages

If needed, we install the tidyverse package

```{r}
#install.packages("tidyverse")
```

Next, we import the tidyverse package
```{r}
library(tidyverse)
library(hms)
```

After this, we start loading all of our different data files.

## Loading climate data per sector 
```{r}
A1_klimaat <- read_delim('./data/binnen/vd_klimaat/1A_vd_klimaat.txt', delim=';', show_col_types = FALSE) %>% mutate(sector = '1', side = 'Rear')
V1_klimaat <- read_delim('./data/binnen/vd_klimaat/1V_vd_klimaat.txt', delim=';', show_col_types = FALSE) %>% mutate(sector = '1', side = 'Front')
A2_klimaat <- read_delim('./data/binnen/vd_klimaat/2A_vd_klimaat.txt', delim=';', show_col_types = FALSE) %>% mutate(sector = '2', side = 'Rear')
V2_klimaat <- read_delim('./data/binnen/vd_klimaat/2V_vd_klimaat.txt', delim=';', show_col_types = FALSE) %>% mutate(sector = '2', side = 'Front')
A5_klimaat <- read_delim('./data/binnen/vd_klimaat/5A_vd_klimaat.txt', delim=';', show_col_types = FALSE) %>% mutate(sector = '5', side = 'Rear')
V5_klimaat <- read_delim('./data/binnen/vd_klimaat/5V_vd_klimaat.txt', delim=';', show_col_types = FALSE) %>% mutate(sector = '5', side = 'Front')
A6_klimaat <- read_delim('./data/binnen/vd_klimaat/6A_vd_klimaat.txt', delim=';', show_col_types = FALSE) %>% mutate(sector = '6', side = 'Rear')
V6_klimaat <- read_delim('./data/binnen/vd_klimaat/6V_vd_klimaat.txt', delim=';', show_col_types = FALSE) %>% mutate(sector = '6', side = 'Front')
```

## Loading temparature data per sector
```{r}
A1_temperatuur <- read_delim('./data/binnen/temperatuur/1A_kastemperatuurklimaat.txt', delim=';', show_col_types = FALSE) %>% mutate(sector = '1', side = 'Rear')
V1_temperatuur <- read_delim('./data/binnen/temperatuur/1V_kastemperatuurklimaat.txt', delim=';', show_col_types = FALSE) %>% mutate(sector = '1', side = 'Front')
A2_temperatuur <- read_delim('./data/binnen/temperatuur/2A_kastemperatuurklimaat.txt', delim=';', show_col_types = FALSE) %>% mutate(sector = '2', side = 'Rear')
V2_temperatuur <- read_delim('./data/binnen/temperatuur/2V_kastemperatuurklimaat.txt', delim=';', show_col_types = FALSE) %>% mutate(sector = '2', side = 'Front')
A5_temperatuur <- read_delim('./data/binnen/temperatuur/5A_kastemperatuurklimaat.txt', delim=';', show_col_types = FALSE) %>% mutate(sector = '5', side = 'Rear')
V5_temperatuur <- read_delim('./data/binnen/temperatuur/5V_kastemperatuurklimaat.txt', delim=';', show_col_types = FALSE) %>% mutate(sector = '5', side = 'Front')
A6_temperatuur <- read_delim('./data/binnen/temperatuur/6A_kastemperatuurklimaat.txt', delim=';', show_col_types = FALSE) %>% mutate(sector = '6', side = 'Rear')
V6_temperatuur <- read_delim('./data/binnen/temperatuur/6V_kastemperatuurklimaat.txt', delim=';', show_col_types = FALSE) %>% mutate(sector = '6', side = 'Front')
```

## Loading CO2 data per sector
```{r}
A1_co2 <- read_delim('./data/binnen/co2/1A_CO2.txt', delim=';', show_col_types = FALSE) %>% mutate(sector = '1', side = 'Rear')
V1_co2 <- read_delim('./data/binnen/co2/1V_CO2.txt', delim=';', show_col_types = FALSE) %>% mutate(sector = '1', side = 'Front')
A2_co2 <- read_delim('./data/binnen/co2/2A_CO2.txt', delim=';', show_col_types = FALSE) %>% mutate(sector = '2', side = 'Rear')
V2_co2 <- read_delim('./data/binnen/co2/2V_CO2.txt', delim=';', show_col_types = FALSE) %>% mutate(sector = '2', side = 'Front')
A5_co2 <- read_delim('./data/binnen/co2/5A_CO2.txt', delim=';', show_col_types = FALSE) %>% mutate(sector = '5', side = 'Rear')
V5_co2 <- read_delim('./data/binnen/co2/5V_CO2.txt', delim=';', show_col_types = FALSE) %>% mutate(sector = '5', side = 'Front')
A6_co2 <- read_delim('./data/binnen/co2/6A_CO2.txt', delim=';', show_col_types = FALSE) %>% mutate(sector = '6', side = 'Rear')
V6_co2 <- read_delim('./data/binnen/co2/6V_CO2.txt', delim=';', show_col_types = FALSE) %>% mutate(sector = '6', side = 'Front')
```

## Loading lighting per sector
```{r}
A1_assimilatiebelichting <- read_delim('./data/binnen/assimilatiebelichting/1A_assimilatiebelichting.txt', delim=';', show_col_types = FALSE) %>% mutate(sector = '1', side = 'Rear')
V1_assimilatiebelichting <- read_delim('./data/binnen/assimilatiebelichting/1V_assimilatiebelichting.txt', delim=';', show_col_types = FALSE) %>% mutate(sector = '1', side = 'Front')
A2_assimilatiebelichting <- read_delim('./data/binnen/assimilatiebelichting/2A_assimilatiebelichting.txt', delim=';', show_col_types = FALSE) %>% mutate(sector = '2', side = 'Rear')
V2_assimilatiebelichting <- read_delim('./data/binnen/assimilatiebelichting/2V_assimilatiebelichting.txt', delim=';', show_col_types = FALSE) %>% mutate(sector = '2', side = 'Front')
A5_assimilatiebelichting <- read_delim('./data/binnen/assimilatiebelichting/5A_assimilatiebelichting.txt', delim=';', show_col_types = FALSE) %>% mutate(sector = '5', side = 'Rear')
V5_assimilatiebelichting <- read_delim('./data/binnen/assimilatiebelichting/5V_assimilatiebelichting.txt', delim=';', show_col_types = FALSE) %>% mutate(sector = '5', side = 'Front')
A6_assimilatiebelichting <- read_delim('./data/binnen/assimilatiebelichting/6A_assimilatiebelichting.txt', delim=';', show_col_types = FALSE) %>% mutate(sector = '6', side = 'Rear')
V6_assimilatiebelichting <- read_delim('./data/binnen/assimilatiebelichting/6V_assimilatiebelichting.txt', delim=';', show_col_types = FALSE) %>% mutate(sector = '6', side = 'Front')
```

## Loading lee side window state per sector
```{r}
A1_luwezijderaamstand <- read_delim('./data/binnen/luwezijderaamstand/1A_luwezijderaamstand.txt', delim=';', show_col_types = FALSE) %>% mutate(sector = '1', side = 'Rear')
V1_luwezijderaamstand <- read_delim('./data/binnen/luwezijderaamstand/1V_luwezijderaamstand.txt', delim=';', show_col_types = FALSE) %>% mutate(sector = '1', side = 'Front')
A2_luwezijderaamstand <- read_delim('./data/binnen/luwezijderaamstand/2A_luwezijderaamstand.txt', delim=';', show_col_types = FALSE) %>% mutate(sector = '2', side = 'Rear')
V2_luwezijderaamstand <- read_delim('./data/binnen/luwezijderaamstand/2V_luwezijderaamstand.txt', delim=';', show_col_types = FALSE) %>% mutate(sector = '2', side = 'Front')
A5_luwezijderaamstand <- read_delim('./data/binnen/luwezijderaamstand/5A_luwezijderaamstand.txt', delim=';', show_col_types = FALSE) %>% mutate(sector = '5', side = 'Rear')
V5_luwezijderaamstand <- read_delim('./data/binnen/luwezijderaamstand/5V_luwezijderaamstand.txt', delim=';', show_col_types = FALSE) %>% mutate(sector = '5', side = 'Front')
A6_luwezijderaamstand <- read_delim('./data/binnen/luwezijderaamstand/6A_luwezijderaamstand.txt', delim=';', show_col_types = FALSE) %>% mutate(sector = '6', side = 'Rear')
V6_luwezijderaamstand <- read_delim('./data/binnen/luwezijderaamstand/6V_luwezijderaamstand.txt', delim=';', show_col_types = FALSE) %>% mutate(sector = '6', side = 'Front')
```

## Loading temperature outside
```{r}
buitentemperatuur <- select(read_delim('./data/buiten/temperatuur.txt', delim=';', show_col_types = FALSE), -group)
```

## loading solar radiation
```{r}
straling <- select(read_delim('./data/buiten/straling.txt', delim=';', show_col_types = FALSE), -group)
```

## loading the sum of solar radiation
```{r}
stralingssom <- select(read_delim('./data/buiten/stralingssom.txt', delim=';', show_col_types = FALSE), -group)
```

## Loading HPS tomato data
```{r}
HPS_sapstroom <- select(read_delim('./data/tomaat/HPS.txt', delim=';', locale=locale(decimal_mark=","), col_types = cols(DateTime = col_character(), Sapstroom = col_double(), Diameter = col_double(), type = col_character())), DateTime...1, Sapstroom)
HPS_diameter <- select(read_delim('./data/tomaat/HPS.txt', delim=';', locale=locale(decimal_mark=","), col_types = cols(DateTime = col_character(), Sapstroom = col_double(), Diameter = col_double(), type = col_character())), DateTime...3, Diameter)

HPS_sapstroom <- HPS_sapstroom %>% rename(DateTime = DateTime...1)
HPS_diameter <- HPS_diameter %>% rename(DateTime = DateTime...3)

HPS <- full_join(HPS_sapstroom, HPS_diameter, by = c('DateTime'))
HPS <- HPS %>% mutate(type = 'HPS')
HPS <- HPS %>% mutate(
    datetime = as.POSIXct(DateTime, format = "%d/%m/%Y %H:%M"), 
    date = as.Date(datetime, format = "%m/%d/%Y"), 
    time = as.hms(datetime, format = "%H:%M:%S"))
```

## Loading LED tomato data
```{r}
LED_sapstroom <- select(read_delim('./data/tomaat/LED.txt', delim=';', locale=locale(decimal_mark=","), col_types = cols(DateTime = col_character(), Sapstroom = col_double(), Diameter = col_double(), type = col_character())), DateTime...1, Sapstroom)
LED_diameter <- select(read_delim('./data/tomaat/LED.txt', delim=';', locale=locale(decimal_mark=","), col_types = cols(DateTime = col_character(), Sapstroom = col_double(), Diameter = col_double(), type = col_character())), DateTime...3, Diameter)

LED_sapstroom <- LED_sapstroom %>% rename(DateTime = DateTime...1)
LED_diameter <- LED_diameter %>% rename(DateTime = DateTime...3)

LED <- full_join(LED_sapstroom, LED_diameter, by = c('DateTime'))
LED <- LED %>% mutate(type = 'LED')
LED <- LED %>% mutate(
    datetime = as.POSIXct(DateTime, format = "%d/%m/%Y %H:%M"), 
    date = as.Date(datetime, format = "%m/%d/%Y"), 
    time = as.hms(datetime, format = "%H:%M:%S"))
```

## Joining the data into tibbles
```{r}
# Klimaat
klimaat <- select(bind_rows(A1_klimaat, V1_klimaat, A2_klimaat, V2_klimaat, A5_klimaat, V5_klimaat, A6_klimaat, V6_klimaat), -group)

# Temperatuur
temperatuur <- select(bind_rows(A1_temperatuur, V1_temperatuur, A2_temperatuur, V2_temperatuur, A5_temperatuur, V5_temperatuur, A6_temperatuur, V6_temperatuur), -group)

# CO2
co2 <- select(bind_rows(A1_co2, V1_co2, A2_co2, V2_co2, A5_co2, V5_co2, A6_co2, V6_co2), -group)

# Assimilatiebelichting
assimilatiebelichting <- select(bind_rows(A1_assimilatiebelichting, V1_assimilatiebelichting, A2_assimilatiebelichting, V2_assimilatiebelichting, A5_assimilatiebelichting, V5_assimilatiebelichting, A6_assimilatiebelichting, V6_assimilatiebelichting), -group)

# Luwezijderaamstand
luwezijderaamstand <- select(bind_rows(A1_luwezijderaamstand, V1_luwezijderaamstand, A2_luwezijderaamstand, V2_luwezijderaamstand, A5_luwezijderaamstand, V5_luwezijderaamstand, A6_luwezijderaamstand, V6_luwezijderaamstand), -group)

# Tomaat-sensors
tomaat <- bind_rows(LED, HPS)
tomaat <- tomaat %>% mutate(Sapstroom = round(Sapstroom, digits=1))
tomaat <- tomaat %>% mutate(type = as.factor(type))
tomaat
```

## Joining the inside & outside data
```{r}
binnen <- full_join(klimaat, temperatuur, by = c("date", "time", "sector", "side"))
binnen <- full_join(binnen, co2, by = c("date", "time", "sector", "side"))
binnen <- full_join(binnen, assimilatiebelichting, by = c("date", "time", "sector", "side"))
binnen <- full_join(binnen, luwezijderaamstand, by = c("date", "time", "sector", "side"))

buiten <- full_join(buitentemperatuur, straling, by = c("date", "time"))
buiten <- full_join(buiten, stralingssom, by = c("date", "time"))

data <- full_join(binnen, buiten, by = c("date", "time"))
data <- data %>% mutate(date = as.Date(date, format='%d-%m-%Y'))
```

## Cleaning it up
```{r}
binnen <- binnen %>% mutate(assimilatiebelichting = factor(assimilatiebelichting, levels = c(0, 100), labels=c("off", "on")))
```

## The data as one Tibble
```{r}
binnen
buiten
data
```
## Visualisations

Firstly, we wanted to see weather there were any major differences in the CO2 Levels between the front and the rear of the greenhouse. So we compared the co2 levels using a box plot. 

```{r}
data %>% filter(CO2 > 0) %>% ggplot(aes(x = side, y = CO2)) + geom_boxplot()
```
As you can see, the greenhouse manages to create a very homogeneous climate when it comes to CO2 levels, this suprised us as we thought that there would be higher CO2 concentrations in some areas as a result of the greenhouse workers passing it more often than other areas.

Next, we wanted to see weather there were any major differences when it comes to the temperature levels between the front and rear areas using a boxplot.

```{r}
data %>% filter(kastemperatuurklimaat > 0) %>% ggplot(aes(x = side, y = kastemperatuurklimaat)) + geom_boxplot()
```
We were surprised to find out that the temperature is not very different between the sectors, as we would've expected this to be affected by the direction of the wind, given that some wind directions create colder wind than others. We were again impressed by the homogeneous nature of the greenhouse as there were no notable differences between the sectors. 


The reason we filtered the kastentemperatuurklimaat > 0 is because there are some datapoints that around -3000 degrees this is just not realistic so we filtered it so the data would be more accurate. 

```{r}
data %>% ggplot(aes(x = date, y = kastemperatuurklimaat)) + geom_point(size=0.1, alpha=0.1)
```
As you can see there are some random points where the readings of the temperature are really low. This is probably because of a malfunction in the thermometers.



After this, we decided to take a look at the tomato data and if there were any notable things to be seen, we started by analysing the juice flow and the way it changes throughout the 3 months of data that we were given. 

```{r}
ggplot(tomaat, mapping = aes(x = date, y = Sapstroom)) + geom_point(size=0.1, alpha=0.1) + geom_smooth()
```
As you can see, there are definitely some fluctuations in the juice flow of the tomato plants, particularly in July, one of the hottest months of the year, when the juice flow dipped lower than in the other 2 months. 

We remembered that Fjo De Ridder told us that one of their main goals was to keep a homogeneous climate in the greenhouse throughout the year. They wanted to keep everything the same throughout the summer and winter months. We started to look at the temperature data on the outside to see how it changed through the year.

```{r}
data %>% filter(buitentemperatuur > -10) %>% ggplot(data, mapping = aes(x = date, y = buitentemperatuur)) + geom_point(size=0.1, alpha=0.1) + geom_smooth()
```
This graph shows a clear Belgian climate, the winters are quite cold with some dips below 0, while the summers are a lot warmer with some warm peaks , particularly in August.

We were excited to find out what difference this data made to the inside of the greenhouse, so we made another grap with a trend line to find out if they were able to keep the greenhouse at a constant temperature.

```{r}
data %>% filter(kastemperatuurklimaat > -10) %>% ggplot(data, mapping = aes(x = date, y = kastemperatuurklimaat)) + geom_point(size=0.1, alpha=0.1) + geom_smooth()
```

Obviously, we expected something around these lines, constant temperatures in the winter/fall/spring, but what surprised us the most, was that the cooling of the greenhouse was insufficient to keep the temperature as low as in the other seasons when it started to get toasty (28°C-30°C) on the outside.

In the dataset, we could see that there are two types of lighting which is given to the tomato plants. One is LED and the other is HPS. We thought it would be interesting to visualise wether there any differences in the plants performance (juice flow, diameter) between the two types of lighting. We used a scatter plot and two colors for the different lighting to show difference between the HPS and LED lighting in relation to the juice flow.

```{r}
ggplot(tomaat, mapping = aes(x = time, y = Sapstroom, color=type)) + geom_point(size=0.1, alpha=0.1) + geom_smooth()
```
We did not expect this! There is a major difference between the LED and the HPS lighting when it comes to the juice flow. A tomato plant his juice flow will be significantly higher when you light it with LED lights as opposed to HPS lights. What also struck us, is that at night, the plants go 'to sleep', as Fjo De Ridder mentioned to us.


Now we will revisit the juice flow graph over the dates but we will also see again the type of lighting and what effect it has on the juice flow and maybe the data differs over the months.

```{r}
ggplot(tomaat, mapping = aes(x = date, y = Sapstroom, color=type)) + geom_point(size=0.1, alpha=0.1) + geom_smooth()
```
As you can see the juice flow for LED-lit tomatoes is on average a lot higher then the HPS-lit tomatoes. Even if we look at the data over the months. This graph is what we expected to see when we saw the data above.


Finally, we wanted to visualise the difference in performance of the tomato plant when it came to its diameter. We made this graph to accentuate the small but very profound difference between the two types of lighting.  


```{r}
ggplot(tomaat, mapping = aes(x = date, y = Diameter, color=type)) + geom_point(size=0.1, alpha=0.1) + geom_smooth()
```

As you can clearly see, the HPS-lit tomatoes their diameter grows a lot faster and reaches a higher peak, while the LED-lit grow slower and don't nearly become as wide as the HPS-lit tomatoes. This was very interesting, but as we are not plant experts, we don't know weather this diameter increase is good or bad for the size and taste of the tomato. 


## Conclusion
Working with the Hortipower dataset was very interesting and challenging to say the least. We believe that we gained some useful insights in the data, especially when it comes to the difference between the LED-lit and the HPS-lit tomato plants, and we hope that we made a useful contribution voor KCE and Hortipower.

Kindest regards
Miguel, Dries & Niels